# 开发日志
## 2025.4.11
10:15 <br>新建项目中引入的okx的api似乎和布欧接针项目中引入的api有点不同，但还是能找到对应的。<br>
例如：布欧的okx.Trade_api对应现在项目中的okx.Trade<br>
一开始还跑不了（报的是网络错误，梯子的问题？）突然就能跑了<br>
这里后来应该就是梯子的问题，偶尔请求会有问题，因为海外服务器上跑没报过这个错
17:30 <br>
完成了交易对平均比价、当前比价和偏离均价的方法，目前测试看来获取的当前k线价是和FMZ上差不多的，但是平均比价有较大偏差。<br>
我猜测是因为FMZ获取的K线数量和我代码获取的K线数量（300条）不同
## 2025.4.14
11:17 早上试了一下布欧的下单方法一直报posSide参数错误，设置杠杆倍数也报这个错误，查了下接口文档发现可能是因为我设置了单向持仓<br>
文档描述：在开平仓模式下必填，且仅可选择 long 或 short。 仅适用交割、永续。<br>
原来这里开平仓模式感觉就对应双向持仓模式，反正我现在是单向持仓，不传posSide就能正常设置杠杆倍数和下单，要想验证是不是持仓模式影响的还得等当前单子做完才能改试一下<br>
另外开单的数量暂时有点问题 amount设置的10usdt，但下单只有0.38，似乎是30倍的关系，得再调一下
11:33 开单数量正好是0.1个当前币
<br>
12:37 杠杆倍数为10时，占用的usdt数量为 （币价 / 10）× （amount_usdt / 10）,所以如果传参时再处理，对amount_usdt ×（100 / 币价），就可以达到想要的效果<br>
14:08 总算调好了，原来计算数量要用到委托价格，委托价格我没传，按理来说要用市价才对<br>
14:48 开仓平仓方法都整好了，现在把逻辑拼一下就能用了（其实我在想要不要把账户设成双向持仓，双向持仓应该能兼容更多的策略，等手上单子整完吧)
23:28 逻辑初步完成，跑一晚上看看有没有问题，后续优化点在首次启动的开单数量的设置、价差变动大开单数量调整，止损设置

## 2025.4.18

14:24 这几天想了下后面可以优化的地方

- ~~错误重试~~ 
- 回测代码（tradingView版 or Python版）
- 其实两个币种大部分的时间的比值是不在均值的，反过来想是否能在均值的时候开单，偏离均值一定程度后离场，这个止盈代码也是一个难点，甚至可以结合原来的代码，开口到一定程度后止盈再开单，回归均值后止盈再开单，利润空间会更大
- ~~日志分类~~ 
  - 开仓、平仓的日志（设置提醒）
  - 当前比价的日志（每分钟发一次，设置成不提醒，这样就不用去服务端看了）

## 2025.4.20
18:02 完成了错误重试和日志分类，并且修改了一下平仓条件
这次虽然盈利了20几u,但最高收益可以达到40u甚至50u<br>
我以为是他真的一直没有回归均值，实际上随着偏离度变大，平均均值也一直在变，所以平仓条件可以不为偏离度的正负相反，要不然会出现虽然已经很接近均值但是一直平不了仓的情况。

## 2025.4.21

9:43 之前用fmz跑这个策略会出现部分平仓的情况，我怀疑之前亏钱就是这个逻辑。我没仔细看过他部分平仓的逻辑是什么，但我想往回偏离一个网格就平掉仓位应该不会亏钱吧，得去试试，例如最大偏离度为0.035，当前偏离度为0.02以下时平仓，感觉这样可以大幅度减少持仓时间，增加开单数量，虽然每单赚的少，但是有薄利多销的效果

## 2025.4.24

9:16 21号开的单和昨天挑的新交易对开的单都平掉了，让我感到疑惑的是APE-BICO这个交易对的最大偏离网格数明明是4，为什么最后平仓的利润只有2.5u，昨天开的仓最大偏离数只有2而且仓位资金只有一半（20u）一网格今天都赚了1.几u，这么一想偏离网格数为2的售后应该利润就有2.几u了，为什么偏离网格数为4也是2.几u想不通，得好好看一下上一单的开仓价格和平均比价了

9:39 分别算了21号和24号的均价比值，21号:4.34,24号4.187，偏离度还有3个网格，实际应该没有这么多，但可以发现，开仓时的均价比值和平仓时的比值均价已经不同了，也就是说平仓时回归的那个均价已经不是开仓时的比值均价了所以收益会变低

9:51 日志输出加入开仓时的比值均价和平仓时的比值均价，考虑平仓时的均价应该是取开仓时的还是取近30日的平仓均价

## 2025.5.4
10:07 4月18日的时候我在想能不能在均值的时候开单，偏离均值一定程度再立场。<br>
如果要做的话得完成这些事 
- 将账户设置为双向持仓
- 代码修改
   - 代码平仓需要指定平的多仓还是空仓
   - 均值回归后拿出全仓的20%做空BICO，观察发现这一个月偏离度较大时，都是BICO价格偏离过大导致，做空BICO即可，需要考虑是否还是用5倍杠杆？
   - 平仓逻辑需要再考虑一下，每偏离5个网格平仓？此时再往原有的回归仓位里补仓感觉非常合理

11:59 发现不能无脑空BICO，这几天的偏离和前三周的偏离是完全反向的<br>
优化一下草神原有的策略应该还行，例如最大偏离网格数是5，回归到3时平掉部分仓位套利，重新设置最大偏离网格数为3。<br>
这种套利方式在偏离度大的情况可以反复套利且缩短持仓时间，就是不知道反复套利的利润比较大还是当下这种一次性套利的利润比较高，可以考虑拿个号测试一下

## 2025.5.7

9:38 APE/BICO 的仓终于平了，除去资金费盈利38u，持仓时间4天，这是我第一次看见他是正向网格，最大偏离度是6个网格，后面偏离网格又变成负的了。所以我在想，如果他的偏离网格数为正，那是不是可以等到偏离反转再平仓？<br>

要是有办法能灵活地设置平仓条件就好了。<br>

想了下之前提到的平仓部分网格，感觉很难盈利，因为本来大几率持仓时是亏损状态，部分平仓肯定还是亏损赚太，偏离6个网格，调整到4.5个网格时还是亏钱的，没必要部分平。

9:46 突然想到，可以仿造fmz的逻辑，类似于平仓参数写进配置文件中然后，然后重新启动代码。<br>

整理一下近期可以做的事情：

- 批量生成前40相关性高度币种的回测图片
- 写个网页可以在线调整平仓参数
- 在网页中可以开启或关闭机器人



## 2025.5.10

9:39 好的我还是不可避免地被影响了情绪，因素有很多。

- BTC冲上了10w，ETH在2100的时候我犹豫没有做多，小错过一波涨幅，大的单边行情还是会让我有点FOMO，我总是会想如果我再BTC 74000 （4月7日）的时候100倍做多该有多爽，我表面好像认可持有BTC就是ALL IS WIN 但是实际操作的时候，给自己做量化不要管其他币种的理由不入场，错过了一波好行情，欸这么看来要持仓一个月，买现货我或许拿的住，合约我确实拿不住，不管是现在的量化还是之前的买大买小我都希望能快进快出尽快平仓看到盈利。或许我应该结合这两者吗，做量化的时候看到好的行情就暂时停止，买入现货或开低倍杠杆感觉也不错
- 这次APE/BICO 已经偏移了12个网格，浮亏最大快到300u，那么这次如果成功盈利的话，收益应该会超过100u吧，但看着浮亏还是有点慌张，想起来第一次碰见这种情况，还是在第一次用FMZ跑这个交易对，当时最大时13个网格吧，忘记了，现在第二次碰到这种情况还是很慌张，想着自己为什么不把每笔投入调小一点，更为从容，然而就是当平仓1个网格，两个网格，三个网格盈利的时候我只会抱怨投入不够多，还是有点矛盾呀
- 补充一下上次的发现，原本我是用300条1h的k线来筛选相关性最高的币种，碰巧发现一个月前的交易对也有ZRX/ZIL，于是就把这个交易对也跑了起来，前几天突发奇想，因为300条小时K线跨越的时间也才2周，于是我就又用300条日线来筛选了一下，没想到ZRX/ZIL排在第一，怪不得这两周测试来看盈利挺稳定的，最大偏离网格是6，因此后面筛选交易对可能要结合这两种筛选方法综合筛选了
