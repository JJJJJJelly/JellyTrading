# 开发日志
## 2025.4.11
10:15 <br>新建项目中引入的okx的api似乎和布欧接针项目中引入的api有点不同，但还是能找到对应的。<br>
例如：布欧的okx.Trade_api对应现在项目中的okx.Trade<br>
一开始还跑不了（报的是网络错误，梯子的问题？）突然就能跑了<br>
这里后来应该就是梯子的问题，偶尔请求会有问题，因为海外服务器上跑没报过这个错
17:30 <br>
完成了交易对平均比价、当前比价和偏离均价的方法，目前测试看来获取的当前k线价是和FMZ上差不多的，但是平均比价有较大偏差。<br>
我猜测是因为FMZ获取的K线数量和我代码获取的K线数量（300条）不同
## 2025.4.14
11:17 早上试了一下布欧的下单方法一直报posSide参数错误，设置杠杆倍数也报这个错误，查了下接口文档发现可能是因为我设置了单向持仓<br>
文档描述：在开平仓模式下必填，且仅可选择 long 或 short。 仅适用交割、永续。<br>
原来这里开平仓模式感觉就对应双向持仓模式，反正我现在是单向持仓，不传posSide就能正常设置杠杆倍数和下单，要想验证是不是持仓模式影响的还得等当前单子做完才能改试一下<br>
另外开单的数量暂时有点问题 amount设置的10usdt，但下单只有0.38，似乎是30倍的关系，得再调一下
11:33 开单数量正好是0.1个当前币
<br>
12:37 杠杆倍数为10时，占用的usdt数量为 （币价 / 10）× （amount_usdt / 10）,所以如果传参时再处理，对amount_usdt ×（100 / 币价），就可以达到想要的效果<br>
14:08 总算调好了，原来计算数量要用到委托价格，委托价格我没传，按理来说要用市价才对<br>
14:48 开仓平仓方法都整好了，现在把逻辑拼一下就能用了（其实我在想要不要把账户设成双向持仓，双向持仓应该能兼容更多的策略，等手上单子整完吧)
23:28 逻辑初步完成，跑一晚上看看有没有问题，后续优化点在首次启动的开单数量的设置、价差变动大开单数量调整，止损设置

## 2025.4.18

14:24 这几天想了下后面可以优化的地方

- ~~错误重试~~ 
- 回测代码（tradingView版 or Python版）
- 其实两个币种大部分的时间的比值是不在均值的，反过来想是否能在均值的时候开单，偏离均值一定程度后离场，这个止盈代码也是一个难点，甚至可以结合原来的代码，开口到一定程度后止盈再开单，回归均值后止盈再开单，利润空间会更大
- ~~日志分类~~ 
  - 开仓、平仓的日志（设置提醒）
  - 当前比价的日志（每分钟发一次，设置成不提醒，这样就不用去服务端看了）

## 2025.4.20
18:02 完成了错误重试和日志分类，并且修改了一下平仓条件
这次虽然盈利了20几u,但最高收益可以达到40u甚至50u<br>
我以为是他真的一直没有回归均值，实际上随着偏离度变大，平均均值也一直在变，所以平仓条件可以不为偏离度的正负相反，要不然会出现虽然已经很接近均值但是一直平不了仓的情况。

## 2025.4.21

9:43 之前用fmz跑这个策略会出现部分平仓的情况，我怀疑之前亏钱就是这个逻辑。我没仔细看过他部分平仓的逻辑是什么，但我想往回偏离一个网格就平掉仓位应该不会亏钱吧，得去试试，例如最大偏离度为0.035，当前偏离度为0.02以下时平仓，感觉这样可以大幅度减少持仓时间，增加开单数量，虽然每单赚的少，但是有薄利多销的效果
